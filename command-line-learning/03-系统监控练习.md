# 🖥️ 系统监控 - 第三阶段

现在你已经掌握了文本处理和管道技能，让我们学习如何监控和管理系统资源！

## 🎯 本阶段目标
学会查看系统状态、监控进程、管理资源使用情况。

## 核心命令详解

### 1. ps - 查看进程
```bash
# 基础用法
ps                      # 显示当前用户的进程
ps aux                  # 显示所有进程的详细信息
ps -ef                  # 另一种显示所有进程的方式

# 常用组合
ps aux | grep "进程名"   # 查找特定进程
ps aux | head -10       # 显示前10个进程
```

### 2. top/htop - 实时系统监控
```bash
top                     # 实时显示系统状态
# 在top中的快捷键：
# q - 退出
# k - 杀死进程
# M - 按内存使用排序
# P - 按CPU使用排序

htop                    # 更友好的系统监控（需要安装）
```

### 3. df - 磁盘使用情况
```bash
df                      # 显示磁盘使用情况
df -h                   # 以人类可读的格式显示（KB, MB, GB）
df -T                   # 显示文件系统类型
```

### 4. du - 文件夹大小
```bash
du 文件夹名             # 显示文件夹大小
du -h 文件夹名          # 以人类可读格式显示
du -s 文件夹名          # 只显示总大小
du -sh *                # 显示当前目录下所有文件夹的大小
```

### 5. free - 内存使用情况
```bash
free                    # 显示内存使用情况
free -h                 # 以人类可读格式显示
free -m                 # 以MB为单位显示
```

### 6. uptime - 系统运行时间
```bash
uptime                  # 显示系统运行时间和负载
```

### 7. who/w - 用户信息
```bash
who                     # 显示当前登录用户
w                       # 显示用户活动详情
whoami                  # 显示当前用户名
```

## 🏃‍♂️ 实践练习

### 练习1：进程管理
```bash
# 查看所有进程
ps aux

# 查找特定程序
ps aux | grep "Terminal"
ps aux | grep "python"

# 按内存使用排序
ps aux --sort=-%mem | head -10

# 按CPU使用排序
ps aux --sort=-%cpu | head -10
```

### 练习2：系统资源监控
```bash
# 查看磁盘使用情况
df -h

# 查看当前目录各文件夹大小
du -sh *

# 查看内存使用情况
free -h

# 查看系统负载
uptime
```

### 练习3：实时监控
```bash
# 启动top监控
top
# 按M键按内存排序
# 按P键按CPU排序
# 按q键退出

# 监控特定进程
top -p $(pgrep python)
```

### 练习4：系统信息收集
```bash
# 创建系统状态报告
echo "=== 系统状态报告 ===" > 系统状态.txt
echo "生成时间：$(date)" >> 系统状态.txt
echo "" >> 系统状态.txt

echo "=== 系统运行时间 ===" >> 系统状态.txt
uptime >> 系统状态.txt
echo "" >> 系统状态.txt

echo "=== 磁盘使用情况 ===" >> 系统状态.txt
df -h >> 系统状态.txt
echo "" >> 系统状态.txt

echo "=== 内存使用情况 ===" >> 系统状态.txt
free -h >> 系统状态.txt
echo "" >> 系统状态.txt

echo "=== 当前用户 ===" >> 系统状态.txt
whoami >> 系统状态.txt
```

## 🔥 高级技巧

### 1. 进程管理
```bash
# 杀死进程
kill PID号              # 正常终止进程
kill -9 PID号           # 强制终止进程
killall 进程名          # 杀死所有同名进程

# 后台运行程序
程序名 &                # 在后台运行
nohup 程序名 &          # 即使关闭终端也继续运行
```

### 2. 系统性能分析
```bash
# 查看系统负载历史
sar -u 1 5              # 每秒显示CPU使用率，共5次

# 查看网络连接
netstat -an             # 显示所有网络连接
ss -tuln                # 现代版本的netstat
```

### 3. 定时监控
```bash
# 每5秒显示一次内存使用情况
watch -n 5 free -h

# 监控磁盘使用变化
watch -n 10 df -h
```

## 💡 实用场景

### 性能问题排查
```bash
# 找出占用CPU最多的进程
ps aux --sort=-%cpu | head -5

# 找出占用内存最多的进程
ps aux --sort=-%mem | head -5

# 查看系统负载
uptime && free -h && df -h
```

### 清理系统空间
```bash
# 找出最大的文件夹
du -sh * | sort -hr | head -10

# 查看临时文件占用
du -sh /tmp
```

### 监控脚本
```bash
#!/bin/bash
# 简单的系统监控脚本
while true; do
    clear
    echo "=== 系统监控 $(date) ==="
    echo "负载：$(uptime | cut -d',' -f3-)"
    echo "内存：$(free -h | grep Mem | awk '{print $3"/"$2}')"
    echo "磁盘：$(df -h / | tail -1 | awk '{print $5}')"
    sleep 5
done
```

## 🎯 掌握标准
完成本阶段后，你应该能够：
- 查看和分析系统进程
- 监控系统资源使用情况
- 识别性能瓶颈
- 创建系统监控报告

## 下一步
接下来我们将学习文本编辑器，让你能够直接在命令行中编辑文件！
