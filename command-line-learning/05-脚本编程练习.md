# 🚀 脚本编程 - 第五阶段

恭喜你来到最后一个阶段！现在我们将学习编写shell脚本，让计算机自动执行重复性任务。

## 🎯 本阶段目标
学会编写bash脚本，实现任务自动化，提高工作效率。

## 脚本基础概念

### 什么是脚本？
脚本是一系列命令的集合，保存在文件中，可以一次性执行多个命令。

### 脚本的优势
- 🔄 自动化重复任务
- ⏰ 节省时间和精力
- 📝 记录操作步骤
- 🔧 批量处理数据

## 基础语法详解

### 1. 脚本结构
```bash
#!/bin/bash
# 这是注释，说明脚本的作用
# 第一行叫做shebang，告诉系统用bash解释器执行

echo "Hello, World!"
```

### 2. 变量
```bash
#!/bin/bash

# 定义变量（注意等号两边不能有空格）
name="张三"
age=25
today=$(date)

# 使用变量
echo "姓名：$name"
echo "年龄：$age"
echo "今天是：$today"
```

### 3. 用户输入
```bash
#!/bin/bash

# 获取用户输入
read -p "请输入你的名字: " username
read -p "请输入你的年龄: " userage

echo "你好，$username！你今年$userage岁。"
```

### 4. 条件判断
```bash
#!/bin/bash

read -p "请输入一个数字: " number

if [ $number -gt 10 ]; then
    echo "这个数字大于10"
elif [ $number -eq 10 ]; then
    echo "这个数字等于10"
else
    echo "这个数字小于10"
fi
```

### 5. 循环
```bash
#!/bin/bash

# for循环
echo "倒计时："
for i in 5 4 3 2 1; do
    echo $i
    sleep 1
done
echo "开始！"

# while循环
count=1
while [ $count -le 3 ]; do
    echo "第 $count 次循环"
    count=$((count + 1))
done
```

### 6. 函数
```bash
#!/bin/bash

# 定义函数
greet() {
    echo "你好，$1！欢迎使用脚本。"
}

# 调用函数
greet "小明"
greet "小红"
```

## 🏃‍♂️ 实践练习

### 练习1：第一个脚本
```bash
cd practice-area-advanced

# 创建第一个脚本
nano my_first_script.sh

# 输入以下内容：
#!/bin/bash
echo "=== 我的第一个脚本 ==="
echo "当前用户：$(whoami)"
echo "当前时间：$(date)"
echo "当前目录：$(pwd)"
echo "脚本执行完成！"

# 保存并退出，然后给脚本执行权限
chmod +x my_first_script.sh

# 运行脚本
./my_first_script.sh
```

### 练习2：交互式脚本
```bash
# 创建交互式脚本
nano user_info.sh

# 输入以下内容：
#!/bin/bash
echo "=== 用户信息收集 ==="
read -p "请输入你的姓名: " name
read -p "请输入你的年龄: " age
read -p "请输入你的城市: " city

echo ""
echo "=== 信息确认 ==="
echo "姓名: $name"
echo "年龄: $age"
echo "城市: $city"

# 保存信息到文件
echo "$name,$age,$city" >> user_data.csv
echo "信息已保存到 user_data.csv"

# 给脚本执行权限并运行
chmod +x user_info.sh
./user_info.sh
```

### 练习3：文件处理脚本
```bash
# 创建文件处理脚本
nano file_organizer.sh

# 输入以下内容：
#!/bin/bash
echo "=== 文件整理工具 ==="

# 创建分类文件夹
mkdir -p organized/{documents,images,scripts,others}

# 移动不同类型的文件
for file in *; do
    if [ -f "$file" ]; then
        case "$file" in
            *.txt|*.md|*.doc)
                mv "$file" organized/documents/
                echo "移动文档: $file"
                ;;
            *.jpg|*.png|*.gif)
                mv "$file" organized/images/
                echo "移动图片: $file"
                ;;
            *.sh)
                mv "$file" organized/scripts/
                echo "移动脚本: $file"
                ;;
            *)
                mv "$file" organized/others/
                echo "移动其他: $file"
                ;;
        esac
    fi
done

echo "文件整理完成！"

# 给脚本执行权限
chmod +x file_organizer.sh
```

### 练习4：系统监控脚本
```bash
# 创建系统监控脚本
nano system_monitor.sh

# 输入以下内容：
#!/bin/bash

# 定义函数
show_system_info() {
    echo "=== 系统信息 ==="
    echo "主机名: $(hostname)"
    echo "系统: $(uname -s)"
    echo "运行时间: $(uptime | cut -d',' -f1)"
    echo ""
}

show_disk_usage() {
    echo "=== 磁盘使用情况 ==="
    df -h | head -5
    echo ""
}

show_memory_usage() {
    echo "=== 内存使用情况 ==="
    free -h
    echo ""
}

show_top_processes() {
    echo "=== CPU使用率最高的5个进程 ==="
    ps aux --sort=-%cpu | head -6
    echo ""
}

# 主程序
clear
echo "系统监控报告 - $(date)"
echo "================================"

show_system_info
show_disk_usage
show_memory_usage
show_top_processes

echo "报告生成完成！"

# 给脚本执行权限并运行
chmod +x system_monitor.sh
./system_monitor.sh
```

## 🔥 高级技巧

### 1. 命令行参数
```bash
#!/bin/bash
echo "脚本名称: $0"
echo "第一个参数: $1"
echo "第二个参数: $2"
echo "所有参数: $@"
echo "参数个数: $#"
```

### 2. 错误处理
```bash
#!/bin/bash
set -e  # 遇到错误立即退出

if [ ! -f "important_file.txt" ]; then
    echo "错误：找不到重要文件！"
    exit 1
fi

echo "文件存在，继续执行..."
```

### 3. 日志记录
```bash
#!/bin/bash
LOG_FILE="script.log"

log() {
    echo "$(date): $1" >> $LOG_FILE
}

log "脚本开始执行"
echo "正在处理数据..."
log "数据处理完成"
```

### 4. 定时任务
```bash
# 编辑定时任务
crontab -e

# 添加定时任务（每天早上9点执行）
0 9 * * * /path/to/your/script.sh

# 查看定时任务
crontab -l
```

## 💡 实用脚本示例

### 自动备份脚本
```bash
#!/bin/bash
BACKUP_DIR="/backup"
SOURCE_DIR="/important_data"
DATE=$(date +%Y%m%d)

mkdir -p $BACKUP_DIR
tar -czf "$BACKUP_DIR/backup_$DATE.tar.gz" $SOURCE_DIR
echo "备份完成: backup_$DATE.tar.gz"
```

### 批量重命名脚本
```bash
#!/bin/bash
for file in *.jpg; do
    if [ -f "$file" ]; then
        new_name="photo_$(date +%Y%m%d)_$file"
        mv "$file" "$new_name"
        echo "重命名: $file -> $new_name"
    fi
done
```

### 网站状态检查脚本
```bash
#!/bin/bash
websites=("google.com" "github.com" "stackoverflow.com")

for site in "${websites[@]}"; do
    if ping -c 1 $site > /dev/null 2>&1; then
        echo "✅ $site 可访问"
    else
        echo "❌ $site 不可访问"
    fi
done
```

## 🎯 脚本开发最佳实践

### 1. 代码规范
- 使用有意义的变量名
- 添加注释说明
- 保持代码简洁清晰

### 2. 错误处理
- 检查文件是否存在
- 验证用户输入
- 提供友好的错误信息

### 3. 测试
- 在安全环境中测试
- 考虑各种边界情况
- 逐步调试复杂脚本

## 🎯 掌握标准
完成本阶段后，你应该能够：
- 编写基础的bash脚本
- 使用变量、条件判断和循环
- 创建交互式脚本
- 编写实用的自动化工具
- 理解脚本开发的最佳实践

## 🎉 恭喜完成所有学习！

你现在已经掌握了：
1. ✅ 文本处理和搜索
2. ✅ 管道和重定向
3. ✅ 系统监控
4. ✅ 文本编辑器
5. ✅ 脚本编程

你已经从命令行新手成长为能够自动化任务的高级用户！继续练习和探索，你会发现命令行的无限可能。
